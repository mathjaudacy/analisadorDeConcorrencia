{% load static %}
{% load meus_filtros %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <!--Estilos-->
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/comparador.css' %}">
</head>
<body>
    
    {% include 'componentes/header.html' %}
    <button onclick="abrirModal()">Abrir Modal</button>

<!-- Estrutura do modal -->
<div id="meuModal" class="modal">
  <div class="modal-conteudo">
    <div class="topoModal">
        <div id="conteudoExplicacao" class="conteudoExplicacao">

        </div>
        <span class="fechar" onclick="fecharModal()">&times;</span>
    </div>
    <table id="tabelaRanking" class="tabelaRanking">
        <thead>
            <th>n°</th>
            <th>Loja</th>
            <th>nome</th>
            <th>preço</th>
        </thead>
        <tbody  >

        </tbody>
    </table>
  </div>
</div>

    <h1 class="titlecomparador">Comparar Produto</h1>
    <a href="{{ destino_nao }}" download>Baixar Produtos incompativeis</a>
    <a href="{{ destino_sim }}" download>Baixar Produtos compativeis</a>
    <button onclick="abrirModal()">compararValores</button>
    <section class="produtosComparados">
        {% for bloco in comparacoes%}
            <div class="containProdutosRasp">
                <div class="produtoRasp">
                    <img src="{{bloco.principal.imagem}}" alt="" class="imgProduto">
                    <h2 class="titleProduto">{{bloco.principal.nome}}</h2>
                    <span class="conMenorValor">
                        <p class="valor">{{bloco.principal.preco|formata_moeda }}</p>
                    </span>
                </div>
                <div class="produtosConcorrentes">
                    {% for concorrente in bloco.concorrentes %}
                        <div class="cardProduto">
                            <img src="{{concorrente.imagem}}" alt="" class="imgProduto">
                            <h2 class="titleProduto">{{concorrente.nome}}</h2>
                            <span class="conMenorValor">
                                <p class="valor">{{concorrente.preco|formata_moeda }}</p>
                            </span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </section>
    {{resultados_ranking|json_script:"dadosComparacao"}}
    {{texto|json_script:"textoAjuste"}}
    <script>

        const tabela = document.getElementById("tabelaRanking");
        const tabelaCorpo = tabela.querySelector("tbody");
        const conteudoExplicacao = document.getElementById("conteudoExplicacao");
        let num = 0;

        function abrirModal() {
            const resultados_ranking = JSON.parse(document.getElementById("dadosComparacao").textContent);
            modalCompararValores(resultados_ranking);
            document.getElementById("meuModal").style.display = "block";
        }

        function fecharModal() {
            document.getElementById("meuModal").style.display = "none";
        }

        function modalCompararValores(value){
            const resultados_ranking = value;
            const texto = JSON.parse(document.getElementById("textoAjuste").textContent);
            conteudoExplicacao.innerHTML = `<p>${texto}</p>`;
            console.log(resultados_ranking)
            tabelaCorpo.innerHTML=""
            resultados_ranking.map((value)=>{
          
                const tr = document.createElement("tr");

                if(value.tipo == "principal"){                  
                    tr.classList = "pdprincipal"
                }
                num += 1
                const tdNum = document.createElement("td")
                tdNum.textContent = num

                const tdNome = document.createElement("td");
                tdNome.textContent = value.nome;

                const tdLoja = document.createElement("td");
                tdLoja.textContent = value.loja;

                const tdPreco = document.createElement("td");
                tdPreco.textContent = `R$ ${value.preco.toFixed(2)}`;
                

                // adiciona as células na linha
                tr.appendChild(tdNum);
                tr.appendChild(tdLoja);
                tr.appendChild(tdNome);
                tr.appendChild(tdPreco);
                tabelaCorpo.appendChild(tr)

            })
        }
    </script>
</body>
</html>